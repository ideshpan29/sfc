<?xml version="1.0" encoding="UTF-8"?>
<bpws:process exitOnStandardFault="no"
    name="comsfcfosImplremoval_tobe_pageflowProcess"
    suppressJoinFailure="yes" tibex:bxVersion="1.15.0"
    tibex:explicitCompensation="yes"
    tibex:xpdlId="_p7fOoN_CEeec4K-r6PSjHg"
    xmlns:bpws="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:tibex="http://www.tibco.com/bpel/2007/extensions" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <tibex:VariableDescriptor type="PersistentBatching">
        <task name="ConfirmDetails">
            <startingVariables>
                <variable>TechnicalInfo</variable>
                <variable>SelectedContractor</variable>
                <variable>TaskName</variable>
                <variable>GroupNames</variable>
                <variable>ContractorNames</variable>
                <variable>Provisioning_Data</variable>
                <variable>SelectedGroup</variable>
                <variable>CommentText</variable>
                <variable>CommentHistory</variable>
            </startingVariables>
            <ProcessManagerScript type="Complete">
                <variable>TaskName</variable>
                <variable>Provisioning_Data</variable>
            </ProcessManagerScript>
            <ProcessManagerScript type="Initiate">
                <variable>TaskName</variable>
                <variable>Provisioning_Data</variable>
            </ProcessManagerScript>
        </task>
        <task name="ScriptTask">
            <startingVariables>
                <variable>Provisioning_Data</variable>
                <variable>CommentDataSet</variable>
                <variable>CommentHistory</variable>
            </startingVariables>
            <ProcessManagerScript type="Complete">
                <variable>Provisioning_Data</variable>
            </ProcessManagerScript>
            <ProcessManagerScript type="Initiate">
                <variable>Provisioning_Data</variable>
            </ProcessManagerScript>
        </task>
        <task name="ServiceTask">
            <startingVariables>
                <variable>commentDataCaseRef</variable>
                <variable>commentDataCase</variable>
            </startingVariables>
            <ProcessManagerScript type="Initiate">
                <variable>TaskName</variable>
                <variable>commentDataCase</variable>
                <variable>Provisioning_Data</variable>
                <variable>CommentText</variable>
            </ProcessManagerScript>
        </task>
    </tibex:VariableDescriptor>
    <bpws:documentation>*** Generated by TIBCO Business Studio.</bpws:documentation>
    <bpws:variables>
        <bpws:variable name="Provisioning_Data"
            tibex:class="com.sfc.fosImpl.dataModel.ProvisioningDataModel"
            tibex:parameter="inout" tibex:xpdlId="_lj7GkN_EEeec4K-r6PSjHg"/>
        <bpws:variable name="TechnicalInfo"
            tibex:class="com.sfc.fosImpl.dataModel.TehnicalInformation"
            tibex:parameter="inout" tibex:xpdlId="_B5SCMOOtEeeI1KWnGZEQgA"/>
        <bpws:variable name="TaskName" tibex:parameter="inout"
            tibex:xpdlId="_yiVywOO_EeeYfI0_sV0YAA" type="xsd:string"/>
        <bpws:variable name="Mail" tibex:parameter="inout"
            tibex:xpdlId="_RHxX4OYZEeep9dkvO_z3LA" type="xsd:string"/>
        <bpws:variable name="GroupNames" tibex:array="yes"
            tibex:parameter="inout"
            tibex:xpdlId="_Ni4kEPEKEee5fIpJptHEZA" type="xsd:string"/>
        <bpws:variable name="SelectedGroup" tibex:parameter="inout"
            tibex:xpdlId="_8EQNMPENEeeJiLkPq4yokA" type="xsd:string"/>
        <bpws:variable name="SelectedContractor" tibex:parameter="inout"
            tibex:xpdlId="_5uqrgPExEeeMCZGsP3rsrw" type="xsd:string"/>
        <bpws:variable name="ContractorNames" tibex:array="yes"
            tibex:parameter="inout"
            tibex:xpdlId="_oC8T0PE1EeeMCZGsP3rsrw" type="xsd:string"/>
        <bpws:variable name="CommentHistory" tibex:array="yes"
            tibex:class="com.sfc.fosImpl.dataModel.CommentData"
            tibex:parameter="inout" tibex:xpdlId="_-MbHoPRPEeeMCZGsP3rsrw"/>
        <bpws:variable name="CommentText" tibex:parameter="inout"
            tibex:xpdlId="_cbofIPR6Eeez78ayMGlX3w" type="xsd:string"/>
        <bpws:variable name="EscalationEmail" tibex:parameter="inout"
            tibex:xpdlId="_CNJI0PUFEeeywP4RjejZPQ" type="xsd:string"/>
        <bpws:variable name="commentDataCase"
            tibex:class="com.sfc.fosImpl.dataModel.CommentDataCase"
            tibex:parameter="inout" tibex:xpdlId="_ZJBQwPacEee_OvMSeNQu6A"/>
        <bpws:variable name="CommentDataSet" tibex:array="yes"
            tibex:classRef="com.sfc.fosImpl.dataModel.CommentDataCase"
            tibex:parameter="inout" tibex:xpdlId="_mN798PavEeeVceMtR_75Ng"/>
        <bpws:variable name="commentDataCaseRef"
            tibex:classRef="com.sfc.fosImpl.dataModel.CommentDataCase"
            tibex:parameter="inout" tibex:xpdlId="_kf1YAfacEee_OvMSeNQu6A"/>
        <bpws:variable name="AccountType" tibex:array="yes"
            tibex:xpdlId="_PNS9kPt1EeeupNwu8S8N4Q" type="xsd:string"/>
        <bpws:variable name="AccountEntries"
            tibex:classRef="com.sfc.fosImpl.dataModel.LookupTable" tibex:xpdlId="_ej8-gft1EeeupNwu8S8N4Q"/>
    </bpws:variables>
    <bpws:extensions>
        <bpws:extension mustUnderstand="yes" namespace="http://www.tibco.com/bpel/2007/extensions"/>
    </bpws:extensions>
    <bpws:eventHandlers/>
    <bpws:flow name="_BX_flow_b7POgPzjEeehkqoKISnbpw">
        <bpws:links>
            <bpws:link name="ConfirmDetails to ServiceTask" tibex:xpdlId="_GAPJYPaZEee_OvMSeNQu6A"/>
            <bpws:link name="ServiceTask to EndEvent" tibex:xpdlId="_Cpfco9_HEeec4K-r6PSjHg"/>
            <bpws:link name="ScriptTask to ConfirmDetails" tibex:xpdlId="_5nGy8N_CEeec4K-r6PSjHg"/>
            <bpws:link name="StartEvent to ScriptTask" tibex:xpdlId="_O0-jIfdiEeeVceMtR_75Ng"/>
        </bpws:links>
        <bpws:extensionActivity>
            <tibex:receiveEvent createInstance="yes" eventTimeout="0"
                name="StartEvent" tibex:type="startEvent"
                tibex:xpdlId="_tHTqYt_CEeec4K-r6PSjHg" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                <bpws:sources>
                    <bpws:source linkName="StartEvent to ScriptTask"/>
                </bpws:sources>
                <tibex:parameters>
                    <parameterDescription mode="InOut" name="SelectedContractor"/>
                    <parameterDescription mode="InOut" name="EscalationEmail"/>
                    <parameterDescription mode="InOut" name="TaskName"/>
                    <parameterDescription mode="InOut" name="GroupNames"/>
                    <parameterDescription mode="InOut" name="Provisioning_Data"/>
                    <parameterDescription mode="InOut" name="commentDataCase"/>
                    <parameterDescription mode="InOut" name="CommentText"/>
                    <parameterDescription mode="InOut" name="TechnicalInfo"/>
                    <parameterDescription mode="InOut" name="commentDataCaseRef"/>
                    <parameterDescription mode="InOut" name="ContractorNames"/>
                    <parameterDescription mode="InOut" name="SelectedGroup"/>
                    <parameterDescription mode="InOut" name="CommentDataSet"/>
                    <parameterDescription mode="InOut" name="Mail"/>
                    <parameterDescription mode="InOut" name="CommentHistory"/>
                </tibex:parameters>
                <tibex:eventSource>
                    <tibex:startEvent eventType="Default"/>
                </tibex:eventSource>
            </tibex:receiveEvent>
        </bpws:extensionActivity>
        <bpws:empty name="EndEvent" tibex:type="endEvent" tibex:xpdlId="_tHTqY9_CEeec4K-r6PSjHg">
            <bpws:targets>
                <bpws:target linkName="ServiceTask to EndEvent"/>
            </bpws:targets>
        </bpws:empty>
        <bpws:extensionActivity>
            <tibex:extActivity name="ConfirmDetails"
                tibex:extendedAttributes="bpmJspTask=form\://comsfcfosImplremoval_tobe_pageflow/comsfcfosImplremoval_tobe_pageflowProcess/ConfirmDetails/GatekeeperApproval.form&#xd;&#xa;"
                tibex:type="userTask"
                tibex:xpdlId="_7fQnYN_CEeec4K-r6PSjHg" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                <bpws:targets>
                    <bpws:target linkName="ScriptTask to ConfirmDetails"/>
                </bpws:targets>
                <bpws:sources>
                    <bpws:source linkName="ConfirmDetails to ServiceTask"/>
                </bpws:sources>
                <model:PageActivityDataModelType xmi:version="2.0"
                    xmlns:model="http://model.pageactivity.n2.tibco.com" xmlns:xmi="http://www.omg.org/XMI">
                    <pageActivityParameters>
                        <pageActivityParameter mandatory="false"
                            mode="INOUT" name="Provisioning_Data"/>
                        <pageActivityParameter mandatory="false"
                            mode="INOUT" name="TechnicalInfo"/>
                        <pageActivityParameter mandatory="false"
                            mode="INOUT" name="TaskName"/>
                        <pageActivityParameter mandatory="false"
                            mode="INOUT" name="GroupNames"/>
                        <pageActivityParameter mandatory="false"
                            mode="INOUT" name="SelectedGroup"/>
                        <pageActivityParameter mandatory="false"
                            mode="INOUT" name="SelectedContractor"/>
                        <pageActivityParameter mandatory="false"
                            mode="INOUT" name="ContractorNames"/>
                        <pageActivityParameter mandatory="false"
                            mode="INOUT" name="CommentText"/>
                        <pageActivityParameter mandatory="false"
                            mode="INOUT" name="CommentHistory"/>
                    </pageActivityParameters>
                </model:PageActivityDataModelType>
                <tibex:completedScript expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[var Log_Activity_Name=TaskName;
var Log_Activity_Type="End";
var Log_Activity_Resource="USER";
Log.write("[SFC_FOS_IMPL] SIEBEL_CIRCUIT_ID="+Provisioning_Data.siebelCircuitID+",CLIENT_NAME="+Provisioning_Data.clientName+",PVM_ID="+Process.getId()+",PROCESS_NAME="+Process.getName()+",ACTIVITY_NAME="+Log_Activity_Name+",ACTIVITY_TYPE="+Log_Activity_Type+",ACTIVITY_RESOURCE="+Log_Activity_Resource+",END_TIME="+DateTimeUtil.createDatetime()+",");]]></tibex:completedScript>
                <tibex:initiatedScript expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[var Log_Activity_Name=TaskName;
var Log_Activity_Type="Start";
var Log_Activity_Resource="USER";
Log.write("[SFC_FOS_IMPL] SIEBEL_CIRCUIT_ID="+Provisioning_Data.siebelCircuitID+",CLIENT_NAME="+Provisioning_Data.clientName+",PVM_ID="+Process.getId()+",PROCESS_NAME="+Process.getName()+",ACTIVITY_NAME="+Log_Activity_Name+",ACTIVITY_TYPE="+Log_Activity_Type+",ACTIVITY_RESOURCE="+Log_Activity_Resource+",BEGIN_TIME="+DateTimeUtil.createDatetime()+",");]]></tibex:initiatedScript>
            </tibex:extActivity>
        </bpws:extensionActivity>
        <bpws:extensionActivity>
            <tibex:extActivity name="ServiceTask"
                tibex:type="serviceTask"
                tibex:xpdlId="_GAOiUPaZEee_OvMSeNQu6A" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                <bpws:targets>
                    <bpws:target linkName="ConfirmDetails to ServiceTask"/>
                </bpws:targets>
                <bpws:sources>
                    <bpws:source linkName="ServiceTask to EndEvent"/>
                </bpws:sources>
                <tibex:script expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[commentDataCaseRef = cac_com_sfc_fosImpl_dataModel_CommentDataCase.create(commentDataCase);]]></tibex:script>
                <tibex:initiatedScript expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[/*var size=CommentHistory.size();
commentDataCase.addedby=CommentHistory.get(size).addedby;
commentDataCase.comments=CommentHistory.get(size).comments;
commentDataCase.taskName=CommentHistory.get(size).stepName;
commentDataCase.time=CommentHistory.get(size).time;
*/
commentDataCase=com_sfc_fosImpl_dataModel_Factory.createCommentDataCase();
commentDataCase.addedby=Process.getOriginatorName();
commentDataCase.comments=CommentText;
for(var index=0; index<TaskName.length; index++) {
	var name=TaskName.replace("_"," ");
}
commentDataCase.taskName=name;
commentDataCase.time=DateTimeUtil.createDatetime();
commentDataCase.siebelCircuitID=Provisioning_Data.siebelCircuitID;

Log.write("[SFC FOS IMPL] The comments are:"+commentDataCase.addedby);
Log.write("[SFC FOS IMPL] The comments are:"+commentDataCase.comments);
Log.write("[SFC FOS IMPL] The comments are:"+commentDataCase.siebelCircuitID);
Log.write("[SFC FOS IMPL] The comments are:"+commentDataCase.taskName);]]></tibex:initiatedScript>
            </tibex:extActivity>
        </bpws:extensionActivity>
        <bpws:extensionActivity>
            <tibex:extActivity name="ScriptTask" tibex:type="scriptTask"
                tibex:xpdlId="_O0-jIPdiEeeVceMtR_75Ng" xmlns:tibex="http://www.tibco.com/bpel/2007/extensions">
                <bpws:targets>
                    <bpws:target linkName="StartEvent to ScriptTask"/>
                </bpws:targets>
                <bpws:sources>
                    <bpws:source linkName="ScriptTask to ConfirmDetails"/>
                </bpws:sources>
                <tibex:script expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[var criteria = "siebelCircuitID='"+Provisioning_Data.siebelCircuitID+"'";
CommentDataSet=cac_com_sfc_fosImpl_dataModel_CommentDataCase.findByCriteria(criteria);

CommentHistory.clear();
if(CommentDataSet.size()>0){
	for(var index=0; index<CommentDataSet.size(); index++) {
		var comment=com_sfc_fosImpl_dataModel_Factory.createCommentData();
		comment.addedby=CommentDataSet.get(index).readCommentDataCase().addedby;
		comment.comments=CommentDataSet.get(index).readCommentDataCase().comments;
		comment.stepName=CommentDataSet.get(index).readCommentDataCase().taskName;
		comment.time=CommentDataSet.get(index).readCommentDataCase().time;
		CommentHistory.add(comment);	
	}
}
var criteria = "enableFlag='Y' AND lookupKey='ACCOUNT_TYPE'";
]]></tibex:script>
                <tibex:completedScript expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[var Log_Activity_Name="Script Task";
var Log_Activity_Type="End";
var Log_Activity_Resource="SYSTEM";
Log.write("[SFC_FOS_IMPL] SIEBEL_CIRCUIT_ID="+Provisioning_Data.siebelCircuitID+",CLIENT_NAME="+Provisioning_Data.clientName+",PVM_ID="+Process.getId()+",PROCESS_NAME="+Process.getName()+",ACTIVITY_NAME="+Log_Activity_Name+",ACTIVITY_TYPE="+Log_Activity_Type+",ACTIVITY_RESOURCE="+Log_Activity_Resource+",END_TIME="+DateTimeUtil.createDatetime()+",");
]]></tibex:completedScript>
                <tibex:initiatedScript expressionLanguage="urn:tibco:wsbpel:2.0:sublang:javascript"><![CDATA[var Log_Activity_Name="Script Task";
var Log_Activity_Type="Start";
var Log_Activity_Resource="SYSTEM";
Log.write("[SFC_FOS_IMPL] SIEBEL_CIRCUIT_ID="+Provisioning_Data.siebelCircuitID+",CLIENT_NAME="+Provisioning_Data.clientName+",PVM_ID="+Process.getId()+",PROCESS_NAME="+Process.getName()+",ACTIVITY_NAME="+Log_Activity_Name+",ACTIVITY_TYPE="+Log_Activity_Type+",ACTIVITY_RESOURCE="+Log_Activity_Resource+",BEGIN_TIME="+DateTimeUtil.createDatetime()+",");]]></tibex:initiatedScript>
            </tibex:extActivity>
        </bpws:extensionActivity>
    </bpws:flow>
</bpws:process>
